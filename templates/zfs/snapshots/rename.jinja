{% extends "layout.jinja" %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Breadcrumb Navigation -->
    <nav class="text-sm text-text-secondary mb-4 flex items-center gap-2">
        <a href="/zfs/pools" class="hover:text-text-primary transition-colors">Pools</a>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <a href="/zfs/snapshots" class="hover:text-text-primary transition-colors">Snapshots</a>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <span class="text-text-primary">Rename</span>
    </nav>

    <!-- Page Header -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-text-primary">Rename Snapshot</h1>
        <p class="text-text-secondary mt-2">Change the name of an existing snapshot</p>
    </div>

    <!-- Error Message -->
    {% if error %}
    {% include "partials/error.jinja" %}
    {% endif %}

    <!-- Info Box -->
    <div class="card-nested bg-info-900/20 border-info-900 mb-6">
        <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-info-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div class="text-sm">
                <strong class="text-info-400">About Renaming:</strong>
                <span class="text-text-secondary">Renaming a snapshot changes only its name, not its content or properties. 
                The snapshot will remain on the same dataset and maintain all its data and relationships.</span>
            </div>
        </div>
    </div>

    <!-- Current Snapshot Info -->
    <div class="card mb-6">
        <h3 class="text-sm font-semibold text-text-secondary mb-3">Current Snapshot:</h3>
        <div class="bg-bg-elevated-2 rounded-lg p-3">
            <code class="text-success-400">{{ snapshot_name }}</code>
        </div>
        <p class="text-text-secondary text-xs mt-2">
            Current name: <span class="text-text-primary font-semibold">{{ current_name }}</span>
        </p>
    </div>

    <!-- Rename Form -->
    <div class="card">
        <form method="post" action="/zfs/snapshots/{{ snapshot_name }}/rename">
            <!-- New Snapshot Name -->
            <div class="mb-6">
                <label for="new_name" class="form-label">
                    New Snapshot Name <span class="text-danger-400">*</span>
                </label>
                <input 
                    type="text" 
                    id="new_name" 
                    name="new_name" 
                    value="{{ new_name or '' }}"
                    required
                    placeholder="e.g., renamed-backup-2025 or new-snapshot-name"
                    pattern="[a-zA-Z0-9_.\-]+"
                    class="form-input"
                >
                <p class="text-text-tertiary text-xs mt-1">
                    Enter only the snapshot name (without @ and dataset). Use alphanumeric characters, hyphens, underscores, and periods only.
                </p>
            </div>

            <!-- Recursive Option -->
            <div class="mb-6">
                <label class="flex items-center cursor-pointer">
                    <input 
                        type="checkbox" 
                        name="recursive" 
                        value="true"
                        {% if recursive %}checked{% endif %}
                        class="form-checkbox"
                    >
                    <span class="ml-2 text-sm text-text-primary">
                        Rename recursively for all descendant datasets
                    </span>
                </label>
                <p class="text-text-tertiary text-xs mt-1 ml-6">
                    If checked and this snapshot is part of a recursive snapshot set, all child dataset snapshots with the same name will also be renamed.
                </p>
            </div>

            <!-- Preview -->
            <div class="card-nested mb-6">
                <h3 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    </svg>
                    Preview
                </h3>
                <div class="space-y-2 text-sm">
                    <div class="flex items-center gap-2">
                        <span class="text-text-secondary">Current:</span>
                        <code class="text-danger-400 bg-bg-elevated-2 px-2 py-1 rounded">{{ snapshot_name }}</code>
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-text-tertiary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                        </svg>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-text-secondary">New:</span>
                        <code class="text-success-400 bg-bg-elevated-2 px-2 py-1 rounded" id="preview-new">
                            {{ snapshot_name.rsplit('@', 1)[0] }}@<span id="new-name-preview">{{ new_name or 'new-name' }}</span>
                        </code>
                    </div>
                </div>
            </div>

            <!-- Important Notes -->
            <div class="card-nested bg-warning-900/20 border-warning-900 mb-6">
                <div class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-warning-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    <div class="text-sm">
                        <strong class="text-warning-400">Important Notes:</strong>
                        <ul class="mt-2 space-y-1 text-text-secondary">
                            <li class="flex items-start gap-2">
                                <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                                <span>Clones and bookmarks referencing this snapshot will continue to work</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                                <span>Replication jobs may need to be updated if they reference this snapshot name</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                                <span>Automated tools (like Sanoid) may lose track of renamed snapshots</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                                <span>Consider the impact on any scripts or monitoring that use the snapshot name</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Naming Guidelines -->
            <div class="card-nested mb-6">
                <h3 class="text-sm font-semibold text-text-primary mb-2 flex items-center gap-2">
                    <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                    </svg>
                    Naming Guidelines
                </h3>
                <ul class="text-xs text-text-secondary space-y-1">
                    <li class="flex items-start gap-2">
                        <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        <span>Choose a descriptive name that indicates the snapshot's purpose or time</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        <span>Be consistent with your naming convention</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        <span>Include dates in a sortable format (YYYY-MM-DD or YYYYMMDD)</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        <span>Avoid special characters beyond hyphens, underscores, and periods</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        <span>Keep names reasonably short but meaningful</span>
                    </li>
                </ul>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button 
                    type="submit"
                    class="btn-primary flex items-center gap-2"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Rename Snapshot
                </button>
                <a 
                    href="/zfs/snapshots/{{ snapshot_name }}/detail" 
                    class="btn-secondary flex items-center gap-2"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// Live preview of new snapshot name
document.getElementById('new_name').addEventListener('input', function(e) {
    const newNamePreview = document.getElementById('new-name-preview');
    newNamePreview.textContent = e.target.value || 'new-name';
});
</script>
{% endblock %}
