{% extends "layout.jinja" %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Breadcrumb Navigation -->
    <nav class="text-sm text-text-secondary mb-4 flex items-center gap-2">
        <a href="/zfs/pools" class="hover:text-text-primary transition-colors">Pools</a>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <a href="/zfs/snapshots" class="hover:text-text-primary transition-colors">Snapshots</a>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <span class="text-text-primary">Clone</span>
    </nav>

    <!-- Page Header -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-text-primary">Clone Snapshot</h1>
        <p class="text-text-secondary mt-2">Create a new writable dataset from a snapshot</p>
    </div>

    <!-- Error Message -->
    {% if error %}
    <div class="card-nested bg-danger-900/20 border-danger-900 mb-6">
        <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-danger-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div class="text-sm">
                <strong class="text-danger-400">Error:</strong>
                <span class="text-text-secondary">{{ error }}</span>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Info Box -->
    <div class="card-nested bg-info-900/20 border-info-900 mb-6">
        <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-info-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div class="text-sm">
                <strong class="text-info-400">About Cloning:</strong>
                <span class="text-text-secondary">Cloning creates a new writable dataset that initially shares all data with the snapshot. 
                This is much faster than copying data and uses minimal space initially. As the clone diverges from the snapshot, 
                it will consume additional space.</span>
            </div>
        </div>
    </div>

    <!-- Source Snapshot Info -->
    <div class="card mb-6">
        <h3 class="text-sm font-semibold text-text-secondary mb-2">Source Snapshot:</h3>
        <code class="px-3 py-2 bg-bg-elevated-2 border border-success-900 text-success-400 rounded-md inline-block">{{ snapshot_name }}</code>
    </div>

    <!-- Clone Form -->
    <div class="card">
        <form method="post" action="/zfs/snapshots/{{ snapshot_name }}/clone">
            <!-- Target Dataset Name -->
            <div class="mb-6">
                <label for="target_dataset" class="form-label">
                    Target Dataset Name <span class="text-danger-400">*</span>
                </label>
                <input 
                    type="text" 
                    id="target_dataset" 
                    name="target_dataset" 
                    value="{{ target_dataset or '' }}"
                    required
                    placeholder="e.g., tank/clones/restored-data or tank/test-environment"
                    pattern="[a-zA-Z0-9_/\-]+"
                    class="form-input"
                >
                <p class="text-text-tertiary text-xs mt-1">
                    The full path for the new cloned dataset. Use alphanumeric characters, hyphens, underscores, and forward slashes only.
                </p>
            </div>

            <!-- Examples -->
            <div class="card-nested mb-6">
                <h3 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    Clone Use Cases
                </h3>
                <div class="space-y-3 text-xs">
                    <div>
                        <strong class="text-success-400">Data Recovery:</strong>
                        <p class="text-text-secondary">Clone a snapshot to recover deleted or corrupted files without affecting the original dataset.</p>
                        <code class="text-info-400 text-xs bg-bg-elevated-2 px-2 py-1 rounded inline-block mt-1">tank/backup/recovered-2025-11-16</code>
                    </div>
                    <div>
                        <strong class="text-success-400">Testing/Development:</strong>
                        <p class="text-text-secondary">Create a test environment with production data without risking the original.</p>
                        <code class="text-info-400 text-xs bg-bg-elevated-2 px-2 py-1 rounded inline-block mt-1">tank/test/dev-environment</code>
                    </div>
                    <div>
                        <strong class="text-success-400">Point-in-Time Access:</strong>
                        <p class="text-text-secondary">Make a writable copy of data as it existed at a specific time.</p>
                        <code class="text-info-400 text-xs bg-bg-elevated-2 px-2 py-1 rounded inline-block mt-1">tank/archive/project-v1.0</code>
                    </div>
                </div>
            </div>

            <!-- Clone Properties -->
            <div class="card-nested mb-6">
                <h3 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4 text-info-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    Clone Characteristics
                </h3>
                <ul class="text-xs text-text-secondary space-y-2">
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 text-success-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span><strong>Instant Creation:</strong> Clones are created almost instantly, regardless of dataset size</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 text-success-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span><strong>Space Efficient:</strong> Initially uses almost no additional space (only metadata)</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 text-success-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span><strong>Fully Writable:</strong> The clone is a normal dataset that can be modified freely</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 text-success-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span><strong>Independent:</strong> Once promoted, the clone becomes independent of the snapshot</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-4 h-4 text-warning-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                        <span><strong>Dependency:</strong> The source snapshot cannot be deleted while clones exist (unless clone is promoted)</span>
                    </li>
                </ul>
            </div>

            <!-- Naming Guidelines -->
            <div class="card-nested mb-6">
                <h3 class="text-sm font-semibold text-text-primary mb-2 flex items-center gap-2">
                    <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                    </svg>
                    Naming Guidelines
                </h3>
                <ul class="text-xs text-text-secondary space-y-1">
                    <li class="flex items-start gap-2">
                        <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        <span>Choose a descriptive name that indicates the clone's purpose</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        <span>Consider using a dedicated clones directory (e.g., pool/clones/...)</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        <span>Include dates or version numbers if relevant</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <svg class="w-3 h-3 text-text-tertiary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        <span>Avoid names that might conflict with existing datasets</span>
                    </li>
                </ul>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button 
                    type="submit"
                    class="btn-success flex items-center gap-2"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                    Create Clone
                </button>
                <a 
                    href="/zfs/snapshots/{{ snapshot_name }}/detail" 
                    class="btn-secondary flex items-center gap-2"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- After Cloning -->
    <div class="mt-6 card-nested bg-primary-900/20 border-primary-900">
        <h3 class="text-sm font-semibold text-primary-400 mb-3 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
            After Creating the Clone
        </h3>
        <ul class="text-xs text-text-secondary space-y-2">
            <li class="flex items-start gap-2">
                <svg class="w-3 h-3 text-primary-400 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span>The clone will appear as a regular dataset in your dataset list</span>
            </li>
            <li class="flex items-start gap-2">
                <svg class="w-3 h-3 text-primary-400 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span>You can mount it, modify it, and manage it like any other dataset</span>
            </li>
            <li class="flex items-start gap-2">
                <svg class="w-3 h-3 text-primary-400 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span>To make the clone fully independent, use the "Promote" action on the cloned dataset</span>
            </li>
            <li class="flex items-start gap-2">
                <svg class="w-3 h-3 text-primary-400 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span>Promoting swaps the dependency, allowing you to delete the original snapshot if needed</span>
            </li>
            <li class="flex items-start gap-2">
                <svg class="w-3 h-3 text-primary-400 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span>Monitor space usage as the clone diverges from the snapshot</span>
            </li>
        </ul>
    </div>
</div>
{% endblock %}
