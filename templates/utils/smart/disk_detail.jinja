{% extends "layout.jinja" %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Breadcrumb Navigation -->
    <nav class="text-sm mb-6 text-text-tertiary">
        <a href="/utils/smart" class="hover:text-blue-400">SMART Monitoring</a> 
        <span class="mx-2">/</span> 
        <span class="text-text-primary">{{ disk_path }}</span>
    </nav>

    <!-- Page Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-text-primary">SMART Data: {{ disk_path }}</h1>
        <div class="space-x-2">
            <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/download" class="bg-green-600 hover:bg-green-700 text-text-primary px-4 py-2 rounded inline-block" hx-boost="false">
                <svg class="w-5 h-5 inline text-info-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                    </svg> Download Report
            </a>
            <a href="/utils/smart" class="btn-secondary hover:bg-bg-elevated-2 text-text-primary px-4 py-2 rounded inline-block">
                ← Back to List
            </a>
        </div>
    </div>

    <!-- Success/Error Messages -->
    {% if request.query_params.get('message') %}
    <div class="bg-success-900/30 border-2 border-success-500/50 text-success-400 px-4 py-3 rounded mb-4">
        {{ request.query_params.get('message') }}
    </div>
    {% endif %}
    
    {% if request.query_params.get('error') %}
    <div class="bg-danger-900/30 border-2 border-danger-500/50 text-danger-400 px-4 py-3 rounded mb-4">
        <strong>Error:</strong> {{ request.query_params.get('error') }}
    </div>
    {% endif %}

    <!-- Quick Links -->
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
        <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/attributes" class="bg-bg-elevated hover:bg-bg-elevated-2 p-4 rounded-lg text-center transition-colors">
            <div class="text-3xl mb-2"><svg class="w-5 h-5 inline text-success-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                    </svg></div>
            <div class="text-text-primary font-semibold">Attributes</div>
        </a>
        <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/health" class="bg-bg-elevated hover:bg-bg-elevated-2 p-4 rounded-lg text-center transition-colors">
            <div class="text-3xl mb-2"><svg class="w-5 h-5 inline text-danger-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg></div>
            <div class="text-text-primary font-semibold">Health</div>
        </a>
        <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/tests" class="bg-bg-elevated hover:bg-bg-elevated-2 p-4 rounded-lg text-center transition-colors">
            <div class="text-3xl mb-2"><svg class="w-5 h-5 inline text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                    </svg></div>
            <div class="text-text-primary font-semibold">Tests</div>
        </a>
        <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/temperature" class="bg-bg-elevated hover:bg-bg-elevated-2 p-4 rounded-lg text-center transition-colors">
            <div class="text-3xl mb-2"><svg class="w-5 h-5 inline text-warning-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg></div>
            <div class="text-text-primary font-semibold">Temperature</div>
        </a>
        <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/errors" class="bg-bg-elevated hover:bg-bg-elevated-2 p-4 rounded-lg text-center transition-colors">
            <div class="text-3xl mb-2"><svg class="w-5 h-5 inline text-warning-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg></div>
            <div class="text-text-primary font-semibold">Error Log</div>
        </a>
        <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/download" class="bg-bg-elevated hover:bg-bg-elevated-2 p-4 rounded-lg text-center transition-colors" hx-boost="false">
            <div class="text-3xl mb-2"><svg class="w-5 h-5 inline text-info-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                    </svg></div>
            <div class="text-text-primary font-semibold">Download</div>
        </a>
    </div>

    <!-- Overall Health Status -->
    {% if smart_data.health %}
    <div class="mb-6">
        <div class="bg-bg-elevated rounded-lg p-6">
            <h2 class="text-xl font-bold text-text-primary mb-4">Overall Health Status</h2>
            <div class="flex items-center">
                <span class="text-5xl mr-4">
                    {% if smart_data.health == 'PASSED' %}<svg class="w-5 h-5 inline text-danger-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>{% else %}<svg class="w-5 h-5 inline text-warning-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>{% endif %}
                </span>
                <div>
                    <div class="text-3xl font-bold {% if smart_data.health == 'PASSED' %}text-green-400{% else %}text-red-400{% endif %}">
                        {{ smart_data.health }}
                    </div>
                    <div class="text-text-tertiary text-sm mt-1">{{ smart_data.timestamp }}</div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Device Information -->
    {% if smart_data.info %}
    <div class="mb-6">
        <div class="bg-bg-elevated rounded-lg p-6">
            <h2 class="text-xl font-bold text-text-primary mb-4">Device Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% if smart_data.info.model %}
                <div>
                    <div class="text-text-tertiary text-sm">Model</div>
                    <div class="text-text-primary font-mono">{{ smart_data.info.model }}</div>
                </div>
                {% endif %}
                {% if smart_data.info.serial %}
                <div>
                    <div class="text-text-tertiary text-sm">Serial Number</div>
                    <div class="text-text-primary font-mono">{{ smart_data.info.serial }}</div>
                </div>
                {% endif %}
                {% if smart_data.info.capacity %}
                <div>
                    <div class="text-text-tertiary text-sm">Capacity</div>
                    <div class="text-text-primary">{{ smart_data.info.capacity }}</div>
                </div>
                {% endif %}
                {% if smart_data.info.firmware %}
                <div>
                    <div class="text-text-tertiary text-sm">Firmware Version</div>
                    <div class="text-text-primary font-mono">{{ smart_data.info.firmware }}</div>
                </div>
                {% endif %}
                <div>
                    <div class="text-text-tertiary text-sm">SMART Available</div>
                    <div class="text-text-primary">
                        {% if smart_data.info.smart_available %}
                        <span class="text-green-400"><svg class="w-5 h-5 inline text-success-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg> Yes</span>
                        {% else %}
                        <span class="text-red-400">✗ No</span>
                        {% endif %}
                    </div>
                </div>
                <div>
                    <div class="text-text-tertiary text-sm">SMART Enabled</div>
                    <div class="text-text-primary">
                        {% if smart_data.info.smart_enabled %}
                        <span class="text-green-400"><svg class="w-5 h-5 inline text-success-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg> Yes</span>
                        {% else %}
                        <span class="text-yellow-400">✗ No</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- SMART Attributes Summary -->
    {% if smart_data.attributes %}
    <div class="mb-6">
        <div class="bg-bg-elevated rounded-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-text-primary">SMART Attributes</h2>
                <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/attributes" class="text-blue-400 hover:text-blue-300">
                    View All Attributes →
                </a>
            </div>
            <div class="text-text-tertiary text-sm">
                Found {{ smart_data.attributes|length }} SMART attributes
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Test Log Summary -->
    {% if smart_data.test_log %}
    <div class="mb-6">
        <div class="bg-bg-elevated rounded-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-text-primary">Recent Self-Tests</h2>
                <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/tests" class="text-blue-400 hover:text-blue-300">
                    View All Tests →
                </a>
            </div>
            {% if smart_data.test_log|length > 0 %}
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm">
                    <thead class="text-text-tertiary border-b border-gray-700">
                        <tr>
                            <th class="text-left py-2">Test Type</th>
                            <th class="text-left py-2">Status</th>
                            <th class="text-left py-2">Remaining</th>
                            <th class="text-left py-2">Lifetime Hours</th>
                        </tr>
                    </thead>
                    <tbody class="text-text-secondary">
                        {% for test in smart_data.test_log[:5] %}
                        <tr class="border-b border-gray-700">
                            <td class="py-2">{{ test.description }}</td>
                            <td class="py-2">
                                <span class="{% if 'Completed' in test.status %}text-green-400{% else %}text-yellow-400{% endif %}">
                                    {{ test.status }}
                                </span>
                            </td>
                            <td class="py-2">{{ test.remaining }}</td>
                            <td class="py-2">{{ test.lifetime }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-text-tertiary text-sm">No self-test log entries found</div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Error Log Summary -->
    <div class="mb-6">
        <div class="bg-bg-elevated rounded-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-text-primary">Error Log</h2>
                <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/errors" class="text-blue-400 hover:text-blue-300">
                    View Full Log →
                </a>
            </div>
            {% if smart_data.error_log and smart_data.error_log|length > 0 %}
            <div class="text-red-400">
                <svg class="w-5 h-5 inline text-warning-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg> {{ smart_data.error_log|length }} error(s) logged
            </div>
            {% else %}
            <div class="text-green-400">
                <svg class="w-5 h-5 inline text-success-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg> No errors logged
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Actions -->
    <div class="bg-bg-elevated rounded-lg p-6">
        <h2 class="text-xl font-bold text-text-primary mb-4">Actions</h2>
        <div class="flex flex-wrap gap-2">
            {% if smart_data.info.smart_enabled %}
            <form method="post" action="/utils/smart/disk/{{ disk_path.lstrip('/') }}/disable" class="inline" id="form-disable-smart">
                <button type="button" 
                        class="bg-orange-600 hover:bg-orange-700 text-text-primary px-4 py-2 rounded"
                        onclick="showConfirm('modal-disable-smart')">
                    Disable SMART
                </button>
            </form>
            {% else %}
            <form method="post" action="/utils/smart/disk/{{ disk_path.lstrip('/') }}/enable" class="inline" id="form-enable-smart">
                <button type="button" 
                        class="bg-green-600 hover:bg-green-700 text-text-primary px-4 py-2 rounded"
                        onclick="showConfirm('modal-enable-smart')">
                    Enable SMART
                </button>
            </form>
            {% endif %}
            <a href="/utils/smart/disk/{{ disk_path.lstrip('/') }}/tests" class="bg-blue-600 hover:bg-blue-700 text-text-primary px-4 py-2 rounded inline-block">
                Run Self-Test
            </a>
        </div>
    </div>
</div>

<!-- Confirmation Modals -->
{% set modal_id = 'modal-disable-smart' %}
{% set modal_title = 'Disable SMART' %}
{% set modal_message = 'Disable SMART monitoring on ' + disk_path + '?' %}
{% set confirm_text = 'Disable' %}
{% set confirm_class = 'warning' %}
{% set action_url = '/smart/disk/' + disk_path.lstrip('/') + '/disable' %}
{% set method = 'post' %}
{% include 'partials/confirm.jinja' %}

{% set modal_id = 'modal-enable-smart' %}
{% set modal_title = 'Enable SMART' %}
{% set modal_message = 'Enable SMART monitoring on ' + disk_path + '?' %}
{% set confirm_text = 'Enable' %}
{% set confirm_class = 'primary' %}
{% set action_url = '/smart/disk/' + disk_path.lstrip('/') + '/enable' %}
{% set method = 'post' %}
{% include 'partials/confirm.jinja' %}
{% endblock %}
